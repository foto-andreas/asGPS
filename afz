#!/bin/bash

VERSION="$1"

MAV=${VERSION%%.*}
RST=${VERSION#*.}
MIV=${RST%.*}
BFV=${RST#*.}

rm -rf asGPS.afplugin &&
  mkdir -p asGPS.afplugin/lib asGPS.afplugin/ui asGPS.afplugin/locale asGPS.afplugin/resources &&
    cp asGPS.afpxml asGPS.afplugin/Info.afpxml &&
    sed -i s/4711/$MAV/ asGPS.afplugin/Info.afpxml &&
    sed -i s/4712/$MIV/ asGPS.afplugin/Info.afpxml &&
    sed -i s/4713/$BFV/ asGPS.afplugin/Info.afpxml &&
    cp libasGPS.so asGPS.afplugin/lib &&
    cp libasGPS.dylib asGPS.afplugin/lib &&
    cp release/asGPS1.dll asGPS.afplugin/lib/asGPS.dll &&
    cp asGPS.ui asGPS.afplugin/ui &&
    cp locale/*.qm asGPS.afplugin/locale &&
    cp "asGPS GPS & IPTC tagging.xmp" "asGPS IPTC tagging.xmp" asGPS.afplugin/resources &&
      zip -r asGPS-$VERSION.afzplug asGPS.afplugin
